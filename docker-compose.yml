version: '3.8'

services:
  # Frontend
  frontend:
    build:
      context: ./burnie-influencer-platform/frontend
      dockerfile: Dockerfile
      args:
        # Pass NEXT_PUBLIC_ variables as build args
        - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:3001}
        - NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL:-http://localhost:3001}
        - NEXT_PUBLIC_AI_BACKEND_URL=${NEXT_PUBLIC_AI_BACKEND_URL:-http://localhost:8000}
        - NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=${NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID:-05882002bee82f700cdbcfb99c981fdd}
        - NEXT_PUBLIC_DEFAULT_CHAIN_ID=${NEXT_PUBLIC_DEFAULT_CHAIN_ID:-8453}
        - NEXT_PUBLIC_BASE_RPC_URL=${NEXT_PUBLIC_BASE_RPC_URL:-https://mainnet.base.org}
        - NEXT_PUBLIC_ROAST_TOKEN_ADDRESS=${NEXT_PUBLIC_ROAST_TOKEN_ADDRESS:-0x1234567890123456789012345678901234567890}
        - NEXT_PUBLIC_USDC_BASE_ADDRESS=${NEXT_PUBLIC_USDC_BASE_ADDRESS:-0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913}
        - NEXT_PUBLIC_MINING_INTERFACE_URL=${NEXT_PUBLIC_MINING_INTERFACE_URL:-http://localhost:3000}
        - NODE_ENV=${NODE_ENV:-development}
    container_name: burnie-frontend
    ports:
      - "3004:3004"
    env_file:
      - ./burnie-influencer-platform/frontend/.env
    networks:
      - burnie-network
    depends_on:
      - typescript-backend
      - python-ai-backend
    restart: unless-stopped

  # TypeScript Backend
  typescript-backend:
    build:
      context: ./burnie-influencer-platform/typescript-backend
      dockerfile: Dockerfile
    container_name: burnie-typescript-backend
    ports:
      - "3001:3001"
    env_file:
      - ./burnie-influencer-platform/typescript-backend/.env
    networks:
      - burnie-network
    restart: unless-stopped

  # Python AI Backend
  python-ai-backend:
    build:
      context: ./burnie-influencer-platform/python-ai-backend
      dockerfile: Dockerfile
    container_name: burnie-python-ai-backend
    ports:
      - "8000:8000"
    env_file:
      - ./burnie-influencer-platform/python-ai-backend/.env
    networks:
      - burnie-network
    volumes:
      - models:/app/models
    restart: unless-stopped

  # Mining Interface
  mining-interface:
    build:
      context: ./mining-interface
      dockerfile: Dockerfile
      args:
        # Pass NEXT_PUBLIC_ variables as build args
        - NEXT_PUBLIC_BURNIE_API_URL=${NEXT_PUBLIC_BURNIE_API_URL:-http://localhost:3001/api}
        - NEXT_PUBLIC_AI_API_URL=${NEXT_PUBLIC_AI_API_URL:-http://localhost:8000}
        - NEXT_PUBLIC_BURNIE_WS_URL=${NEXT_PUBLIC_BURNIE_WS_URL:-ws://localhost:3001/ws}
        - NEXT_PUBLIC_DEFAULT_CHAIN_ID=${NEXT_PUBLIC_DEFAULT_CHAIN_ID:-8453}
        - NEXT_PUBLIC_BASE_RPC_URL=${NEXT_PUBLIC_BASE_RPC_URL:-https://mainnet.base.org}
        - NEXT_PUBLIC_BASE_TESTNET_RPC_URL=${NEXT_PUBLIC_BASE_TESTNET_RPC_URL:-https://sepolia.base.org}
        - NEXT_PUBLIC_ROAST_TOKEN_ADDRESS=${NEXT_PUBLIC_ROAST_TOKEN_ADDRESS:-0x1234567890123456789012345678901234567890}
        - NEXT_PUBLIC_USDC_BASE_ADDRESS=${NEXT_PUBLIC_USDC_BASE_ADDRESS:-0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913}
        - NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=${NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID:-05882002bee82f700cdbcfb99c981fdd}
        - NEXT_PUBLIC_APP_NAME=${NEXT_PUBLIC_APP_NAME:-Burnie Mining Interface}
        - NEXT_PUBLIC_TWITTER_CLIENT_ID=${NEXT_PUBLIC_TWITTER_CLIENT_ID:-Y1NzMnpZVDdrWU5EUktzZUhuNXg6MTpjaQ}
        - NEXT_PUBLIC_TWITTER_REDIRECT_URI=${NEXT_PUBLIC_TWITTER_REDIRECT_URI:-http://localhost:3000/twitter-callback}
        - NEXT_PUBLIC_ENVIRONMENT=${NEXT_PUBLIC_ENVIRONMENT:-development}
        - NEXT_PUBLIC_AGENT_STORAGE_URL=${NEXT_PUBLIC_AGENT_STORAGE_URL:-http://localhost:3001/api/agents}
        - NODE_ENV=${NODE_ENV:-development}
    container_name: burnie-mining-interface
    ports:
      - "3000:3000"
    env_file:
      - ./mining-interface/.env
    networks:
      - burnie-network
    depends_on:
      - typescript-backend
      - python-ai-backend
    restart: unless-stopped

networks:
  burnie-network:
    driver: bridge

volumes:
  models: 
