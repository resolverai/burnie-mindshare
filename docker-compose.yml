version: '3.8'

services:
  # Frontend
  frontend:
    build:
      context: ./burnie-influencer-platform/frontend
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-https://mindshareapi.burnie.io}
        - NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL:-https://mindshareapi.burnie.io}
        - NEXT_PUBLIC_AI_BACKEND_URL=${NEXT_PUBLIC_AI_BACKEND_URL:-https://attentionai.burnie.io}
        - NEXT_PUBLIC_BURNIE_WS_URL=${NEXT_PUBLIC_BURNIE_WS_URL:-wss://attentionai.burnie.io}
        - NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=${NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID:-05882002bee82f700cdbcfb99c981fdd}
        - NEXT_PUBLIC_DEFAULT_CHAIN_ID=${NEXT_PUBLIC_DEFAULT_CHAIN_ID:-8453}
        - NEXT_PUBLIC_BASE_RPC_URL=${NEXT_PUBLIC_BASE_RPC_URL:-https://mainnet.base.org}
        - NEXT_PUBLIC_ROAST_TOKEN_ADDRESS=${NEXT_PUBLIC_ROAST_TOKEN_ADDRESS:-0x1234567890123456789012345678901234567890}
        - NEXT_PUBLIC_USDC_BASE_ADDRESS=${NEXT_PUBLIC_USDC_BASE_ADDRESS:-0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913}
        - NEXT_PUBLIC_MINING_INTERFACE_URL=${NEXT_PUBLIC_MINING_INTERFACE_URL:-https://mining.burnie.io}
        - NEXT_PUBLIC_CONTRACT_ROAST_TOKEN=${NEXT_PUBLIC_CONTRACT_ROAST_TOKEN:-0x06fe6D0EC562e19cFC491C187F0A02cE8D5083E4}
        - NEXT_PUBLIC_TREASURY_WALLET_ADDRESS=${NEXT_PUBLIC_TREASURY_WALLET_ADDRESS:-0x3E0B1D31454b982A02517F97dD2aE71Bd1C9ee6E}
        - NEXT_PUBLIC_TWITTER_CLIENT_ID=${NEXT_PUBLIC_TWITTER_CLIENT_ID:-Y1NzMnpZVDdrWU5EUktzZUhuNXg6MTpjaQ}
        - NEXT_PUBLIC_YAPPER_TWITTER_REDIRECT_URI=${NEXT_PUBLIC_YAPPER_TWITTER_REDIRECT_URI:-https://yap.burnie.io/yapper-twitter-callback}
        - NEXT_PUBLIC_APP_NAME=${NEXT_PUBLIC_APP_NAME:-Burnie Yapper Platform}
        - NEXT_PUBLIC_APP_DESCRIPTION=${NEXT_PUBLIC_APP_DESCRIPTION:-AI-powered content marketplace for yappers}
    container_name: burnie-frontend
    ports:
      - "3004:3004"
    env_file:
      - ./burnie-influencer-platform/frontend/.env
    networks:
      - burnie-network
    depends_on:
      - typescript-backend
      - python-ai-backend
    restart: unless-stopped

  # TypeScript Backend
  typescript-backend:
    build:
      context: ./burnie-influencer-platform/typescript-backend
      dockerfile: Dockerfile
    container_name: burnie-typescript-backend
    network_mode: host
    env_file:
      - ./burnie-influencer-platform/typescript-backend/.env
    environment:
      - REDIS_HOST=localhost
      - REDIS_PORT=6379
      - REDIS_PASSWORD=
    restart: unless-stopped

  # Python AI Backend
  python-ai-backend:
    build:
      context: ./burnie-influencer-platform/python-ai-backend
      dockerfile: Dockerfile
    container_name: burnie-python-ai-backend
    network_mode: host
    env_file:
      - ./burnie-influencer-platform/python-ai-backend/.env
    environment:
      - REDIS_HOST=localhost
      - REDIS_PORT=6379
      - REDIS_PASSWORD=
    volumes:
      - models:/app/models
    restart: unless-stopped

  # Mining Interface
  mining-interface:
    build:
      context: ./mining-interface
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_BURNIE_API_URL=${NEXT_PUBLIC_BURNIE_API_URL:-https://mindshareapi.burnie.io/api}
        - NEXT_PUBLIC_AI_API_URL=${NEXT_PUBLIC_AI_API_URL:-https://attentionai.burnie.io}
        - NEXT_PUBLIC_BURNIE_WS_URL=${NEXT_PUBLIC_BURNIE_WS_URL:-wss://attentionai.burnie.io}
        - NEXT_PUBLIC_PYTHON_AI_BACKEND_URL=${NEXT_PUBLIC_PYTHON_AI_BACKEND_URL:-https://attentionai.burnie.io}
        - NEXT_PUBLIC_TYPESCRIPT_BACKEND_URL=${NEXT_PUBLIC_TYPESCRIPT_BACKEND_URL:-https://mindshareapi.burnie.io}
        - NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=${NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID:-05882002bee82f700cdbcfb99c981fdd}
        - NEXT_PUBLIC_DEFAULT_CHAIN_ID=${NEXT_PUBLIC_DEFAULT_CHAIN_ID:-8453}
        - NEXT_PUBLIC_BASE_RPC_URL=${NEXT_PUBLIC_BASE_RPC_URL:-https://mainnet.base.org}
        - NEXT_PUBLIC_ROAST_TOKEN_ADDRESS=${NEXT_PUBLIC_ROAST_TOKEN_ADDRESS:-0x1234567890123456789012345678901234567890}
        - NEXT_PUBLIC_USDC_BASE_ADDRESS=${NEXT_PUBLIC_USDC_BASE_ADDRESS:-0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913}
        - NEXT_PUBLIC_TWITTER_CLIENT_ID=${NEXT_PUBLIC_TWITTER_CLIENT_ID:-Y1NzMnpZVDdrWU5EUktzZUhuNXg6MTpjaQ}
        - NEXT_PUBLIC_TWITTER_REDIRECT_URI=${NEXT_PUBLIC_TWITTER_REDIRECT_URI:-https://mining.burnie.io/twitter-callback}
        - NEXT_PUBLIC_ENVIRONMENT=${NEXT_PUBLIC_ENVIRONMENT:-production}
        - NEXT_PUBLIC_AGENT_STORAGE_URL=${NEXT_PUBLIC_AGENT_STORAGE_URL:-https://mindshareapi.burnie.io/api/agents}
        - NEXT_PUBLIC_CONTRACT_ROAST_TOKEN=${NEXT_PUBLIC_CONTRACT_ROAST_TOKEN:-0x1234567890123456789012345678901234567890}
        - NEXT_PUBLIC_TREASURY_WALLET_ADDRESS=${NEXT_PUBLIC_TREASURY_WALLET_ADDRESS:-0x0987654321098765432109876543210987654321}
        - NEXT_PUBLIC_APP_NAME=${NEXT_PUBLIC_APP_NAME:-Burnie Mining Interface}
        - NEXT_PUBLIC_APP_DESCRIPTION=${NEXT_PUBLIC_APP_DESCRIPTION:-AI-powered content mining platform}
        - NEXT_PUBLIC_MINER=${NEXT_PUBLIC_MINER:-0}
        - NEXT_PUBLIC_APP_VERSION=${NEXT_PUBLIC_APP_VERSION:-2.0.0}
        - NEXT_PUBLIC_DEFAULT_LLM_PROVIDER=${NEXT_PUBLIC_DEFAULT_LLM_PROVIDER:-openai}
        - NEXT_PUBLIC_SUPPORTED_PROVIDERS=${NEXT_PUBLIC_SUPPORTED_PROVIDERS:-openai,claude,gemini}
        - NEXT_PUBLIC_ENABLE_AGENT_PERSISTENCE=${NEXT_PUBLIC_ENABLE_AGENT_PERSISTENCE:-true}
        - NEXT_PUBLIC_STORAGE_PREFIX=${NEXT_PUBLIC_STORAGE_PREFIX:-burnie_mining_}
    container_name: burnie-mining-interface
    ports:
      - "3000:3000"
    env_file:
      - ./mining-interface/.env
    networks:
      - burnie-network
    depends_on:
      - typescript-backend
      - python-ai-backend
    restart: unless-stopped

networks:
  burnie-network:
    driver: bridge

volumes:
  models: 
